<%- include('../partials/head.ejs') %> 
  <body>
    <div class="header">
      <p>BKK <span>2D</span> <span>3D</span></p>
    </div>
     
    <div class="content">
      <div class="datetime">
        <img src="schedule.png" style="width: 25px; height: 25px" alt="" />
        <span class="date" id="date">14/05/2022</span>
        <span class="time" id="time">11:00:35</span>
      </div>
      <div class="top-content">
        <div class="buy-sell">
          <div class="card" style="flex-grow: 1; margin-right: 10px">
            <p class="card-label">Buy</p>
            <p class="card-number blink_me" id="buy-data">1.333</p>
          </div>
          <div class="card" style="flex-grow: 1; margin-left: 10px">
            <p class="card-label">3D</p>
            <p class="card-number" id="d3-data">293</p>
          </div>
        </div>
        <div class="buy-sell">
          <div class="card" style="flex-grow: 1; margin-right: 10px">
            <p class="card-label">Sell</p>
            <p class="card-number blink_me" id="sell-data">2.392</p>
          </div>
          <div class="card" style="flex-grow: 1; margin-left: 10px">
            <p class="card-label">2D</p>
            <p class="card-number" id="d2-data">22</p>
          </div>
        </div>
      </div>
      <% if(data){ %> 
      <div class="round">
        <p class="round-time">Round <%- data.time %></p>
        <div class="card round-card">
          <div class="round-result">
            <p class="round-title">Buy</p>
            <p class="round-number"><%- data.buy %></p>
          </div>
          <div class="round-result">
            <p class="round-title">Sell</p>
            <p class="round-number"><%- data.sell %></p>
          </div>
          <div class="round-result">
            <p class="round-title">3D</p>
            <p class="round-number"><%- data.three_d %></p>
          </div>
          <div class="round-result">
            <p class="round-title">2D</p>
            <p class="round-number"><%- data.two_d %></p>
          </div>
        </div>
      </div>
      <% } %> 
      <div class="actions">
        <div class="result">
          <button class="result-btn" onclick="location.href='/results'">
            <img src="bar-chart.png" alt="" /> Results
          </button>
        </div>
        <!-- <div class="server">
          <button class="server-btn" onclick="location.href='/stats'">
            <img src="server.png" alt="" /> Server Busy
          </button>
        </div> -->
      </div>
    </div>
  </body>

  <script>
    function getLiveData() {
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, "0");
      const mm = String(today.getMonth() + 1).padStart(2, "0"); //January is 0!
      const yyyy = today.getFullYear();
      document.getElementById("date").innerText = dd + "/" + mm + "/" + yyyy;
      document.getElementById("time").innerText = today.toLocaleTimeString();

      let xmlHttp = null;
      xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", "/live", false);
      xmlHttp.send(null);
      let data = JSON.parse(xmlHttp.response);
      document.getElementById("buy-data").innerText = data.num_one;
      document.getElementById("sell-data").innerText = data.num_two;
      document.getElementById("d3-data").innerText = data.three_d;
      document.getElementById("d2-data").innerText = data.two_d;
    }
    setInterval(() => {
      getLiveData();
    }, 1000);
  </script>
</html>
